@model IEnumerable<EMG_website.Models.Voiture>

<h2>Dashboard</h2>
<p>Bienvenue dans le tableau de bord, admin!</p>

<table class="table">
    <thead>
        <tr>
            <th>Marque</th>
            <th>Modèle</th>
            <th>Année</th>
            <th>Code VIN</th>
            <th>Description</th>
            <th>Prix d'achat</th>
            <th>Date d'achat</th>
            <th>Reparation</th>
            <th>Prix de réparation</th>
            <th>Finition</th>
            <th>Est vendu</th>

            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var voiture in Model)
        {
                    <tr>
                         <td>@voiture.Marque</td>
                          <td>@voiture.Modele</td>
                        <td>@voiture.Annee</td>    
                        <td>@voiture.CodeVIN</td>
                        <td>@voiture.Description</td>
                        <td>@voiture.PrixAchat</td>
                        <td>@voiture.DateAchat</td>
                        <td>@voiture.Reparation</td>
                        <td>@voiture.PrixReparation</td>
                        <td>@voiture.Finition</td>
                        <td>@voiture.EstVendue</td>                                          
                    <td>                       
                    <button type="button" class="btn btn-primary editButton mb-3" data-bs-toggle="modal" data-bs-target="#editCarModal" data-voiture='@Newtonsoft.Json.JsonConvert.SerializeObject(voiture)'>Modifier</button>
                    <button type="button" class="btn btn-danger deleteButton" data-bs-toggle="modal" data-bs-target="#deleteConfirmModal" data-id="@voiture.Id">Supprimer</button>

                </td>
                </tr>
        }
    </tbody>
</table>

<button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addCarModal">+ Ajouter Voiture</button>


<form asp-controller="Account" asp-action="Logout" method="post" class="mt-3">
    <button type="submit" class="btn btn-warning">Logout</button>
</form>

<!-- Modale Ajouter Voiture -->
<div class="modal fade" id="addCarModal" tabindex="-1" role="dialog" aria-labelledby="addCarModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addCarModalLabel">Ajouter une nouvelle voiture</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="addCarForm">
          <!-- Champ Marque -->
          <div class="form-group">
            <label for="Marque">Marque</label>
            <input type="text" class="form-control" id="Marque" name="Marque" required>

          </div>
          <!-- Ajoutez d'autres champs ici -->
            <!-- Champ Modèle -->
            <div class="form-group">
                <label for="Modele">Modèle</label>
                <input type="text" class="form-control" id="Modele" name="Modele" required>
            </div>

            <!-- Champ Année -->
            <div class="form-group">
                <label for="Annee">Année</label>
                <input type="number" class="form-control" id="Annee" name="Annee" required>
            </div>

            <!-- Code_vin -->
            <div class="form-group">
                <label for="CodeVIN">Code VIN</label>
                <input type="text" class="form-control" id="CodeVIN" name="CodeVIN" required>
            </div>

            <!-- Kilométrage -->
            <div class="form-group">
                <label for="Description">Description</label>
                <input type="text" class="form-control" id="Description" name="Description" required>
            </div>

            <!-- Prix_achat -->
            <div class="form-group">
                <label for="PrixAchat">Prix d'achat</label>
                <input type="number" class="form-control" id="PrixAchat" name="PrixAchat" required>
            </div>

            <div class="form-group">
                <label for="DateAchat">Date d'achat</label>
                <input type="date" class="form-control" id="DateAchat" name="DateAchat" required>
            </div>

            <div class="form-group">
                <label for="Reparation">Reparation</label>
                <input type="text" class="form-control" id="Reparation" name="Reparation" required>
            </div>

            <div class="form-group">
                <label for="PrixReparation">Prix de réparation</label>
                <input type="number" class="form-control" id="PrixReparation" name="PrixReparation" required>
            </div>

            <div class="form-group">
                <label for="Finition">Finition</label>
                <input type="text" class="form-control" id="Finition" name="Finition" required>
            </div>


          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Fermer</button>
            <button type="submit" class="btn btn-primary">Sauvegarder</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Modale Modifier Voiture -->
<div class="modal fade" id="editCarModal" tabindex="-1" role="dialog" aria-labelledby="editCarModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editCarModalLabel">Modifier la voiture</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="editCarForm">
          <!-- Champ Marque -->
          <div class="form-group>
            <label for="Marque">Marque</label>
            <input type="text" class="form-control" id="Marque" name="Marque" required>
            </div>
            <!-- Ajoutez d'autres champs ici -->
            <!-- Champ Modèle -->
            <div class="form-group">
                <label for="Modele">Modèle</label>
                <input type="text" class="form-control" id="Modele" name="Modele" required>
            </div>

            <!-- Champ Année -->
            <div class="form-group">
                <label for="Annee">Année</label>
                <input type="number" class="form-control" id="Annee" name="Annee" required>
                </div>

                <!-- Code_vin -->
                <div class="form-group
                <label for="CodeVIN">Code VIN</label>
                <input type="text" class="form-control" id="CodeVIN" name="CodeVIN" required>
                </div>

                <!-- Kilométrage -->
                <div class="form-group
                <label for="Description">Description</label>
                <input type="text" class="form-control" id="Description" name="Description" required>
                </div>

                <div class="form-group
                <label for="Reparation">Reparation</label>
                <input type="text" class="form-control" id="Reparation" name="Reparation" required>
                </div>

                <div class="form-group
                <label for="PrixReparation">Prix de réparation</label>
                <input type="number" class="form-control" id="PrixReparation" name="PrixReparation" required>
                </div>


                

<div class="form-check">
  <input class="form-check-input" type="checkbox" value="True" id="EstVendu">
  <label class="form-check-label" for="EstVendu">
    True
  </label>
</div>
<div class="form-check">
  <input class="form-check-input" type="checkbox" value="False" id="EstVendu" checked>
  <label class="form-check-label" for="EstVendu">
    False
  </label>
</div>


                <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Fermer</button>
            <button type="submit" class="btn btn-primary">Modifier</button>
            </div>
        </form>
        </div>

    </div>
    </div>
</div>

<!-- Modale Confirmation Suppression -->
<div class="modal fade" id="deleteConfirmModal" tabindex="-1" role="dialog" aria-labelledby="deleteConfirmModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="deleteConfirmModalLabel">Confirmer la suppression</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        Êtes-vous sûr de vouloir supprimer cette voiture?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Annuler</button>
        <button type="button" class="btn btn-danger" id="confirmDeleteButton">Supprimer</button>
      </div>
    </div>
  </div>


<script>
$(document).ready(function() {
   $('#addCarForm').on('submit', function(e) {
        e.preventDefault(); // Empêche la soumission standard du formulaire
        var formData = $(this).serialize();
        $.ajax({
            type: 'POST',
            url: '@Url.Action("InsertVoiture", "Dashboard")',
            data: formData,
            success: function(response) {
                $('#addCarModal').modal('hide');
                location.reload(); // Recharge la page pour voir les changements
            },
            error: function(error) {
                console.log(error);
                alert('Erreur lors de l\'ajout de la voiture');
            }
        });
    });
});

// Edit Button Click: Set form values based on the selected car
$('.editButton').click(function() {
    var voiture = $(this).data('voiture');
    // Populate the form fields with the voiture data
    $('#editCarForm #Marque').val(voiture.Marque);
    $('#editCarForm #Modele').val(voiture.Modele);
    $('#editCarForm #Annee').val(voiture.Annee);
    //EstVendu
    $('#editCarForm #EstVendu').val(voiture.EstVendu);
    

    $('#editCarForm #CodeVIN').val(voiture.CodeVIN);
    $('#editCarForm #Description').val(voiture.Description);
    $('#editCarForm #Reparation').val(voiture.Reparation);
    $('#editCarForm #PrixReparation').val(voiture.PrixReparation);

    $('#editCarForm').attr('data-id', voiture.Id); // Store the car's ID
    $('#editCarModal').modal('show');
});

// Handle the form submission for editing a car
$('#editCarForm').submit(function(e) {
    e.preventDefault();
    var id = $(this).data('id'); // Retrieve the car's ID
    var formData = $(this).serialize() + "&Id=" + id;
    $.ajax({
        type: 'POST',
        url: '@Url.Action("UpdateVoiture", "Dashboard")', // Adjust URL as needed
        data: formData,
        success: function(response) {
            $('#editCarModal').modal('hide');
            location.reload(); // Refresh to see changes
        },
        error: function(error) {
            console.error("Update error", error);
            alert('Erreur lors de la modification.');
        }
    });
});


// Handle the delete button click
$('.deleteButton').click(function() {
    var id = $(this).data('id'); // Retrieve the car's ID
    $('#confirmDeleteButton').attr('data-id', id); // Store the car's ID
    $('#deleteConfirmModal').modal('show');
});

// Handle the confirmation of the delete
$('#confirmDeleteButton').click(function() {
    var id = $(this).data('id'); // Retrieve the car's ID
    $.ajax({
        type: 'POST',
        url: '@Url.Action("DeleteVoiture", "Dashboard")', // Adjust URL as needed
        data: { id: id },
        success: function(response) {
            $('#deleteConfirmModal').modal('hide');
            location.reload(); // Refresh to see changes
        },
        error: function(error) {
            console.error("Delete error", error);
            alert('Erreur lors de la suppression.');
        }
    });
});





</script>
